#!/bin/bash

test -f .build.i18n.fmt || test "x$1" = "xbuild.i18n" || ./i18n-format build.i18n

cat $1 | grep % | grep "^[0-9]" \
    | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" \
    | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" \
    | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" \
    | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" \
    | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" \
    | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" \
    | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" | sed "s/:[^%]*\(%[-0-9l]*.\)/.\1:/g;s/:[^%]*$//" \
    > .$1.fmt;

test "x$1" = "xbuild.i18n" && exit 0;

ERR=$(diff -u0 .build.i18n.fmt .$1.fmt | grep -v ^@ | sed "s/^.\(....\).*/\1/" | grep "^[0-9]" \
      | sort | uniq -c | grep -v "^      1" | sed "s/^........//")

for f in :: $ERR; do grep $f .$1.fmt; grep $f .build.i18n.fmt; done
